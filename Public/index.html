<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Cover B2B Portal</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0b0e14; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: #151a22; padding: 40px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.8); text-align: center; width: 320px; border: 1px solid #2b3544; border-top: 4px solid #8e44ad; }
        h1 { color: #fff; margin-bottom: 5px; font-size: 24px; text-transform: uppercase; letter-spacing: 2px;}
        .brand-accent { color: #8e44ad; }
        p { color: #8b9eb7; font-size: 14px; margin-bottom: 30px; }
        input { width: 90%; padding: 14px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #2b3544; background: #0f131a; color: white; font-size: 14px; text-align: center; transition: 0.3s; outline: none; }
        input:focus { border-color: #8e44ad; }
        button { width: 100%; padding: 14px; background: #8e44ad; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px;}
        button:hover { background: #732d91; box-shadow: 0 0 15px rgba(142, 68, 173, 0.4); }
        .error { color: #ff1744; font-size: 13px; margin-top: 15px; display: none; background: rgba(255, 23, 68, 0.1); padding: 10px; border-radius: 6px; border: 1px solid rgba(255, 23, 68, 0.3); }
    </style>
</head>
<body>

    <div class="login-box">
        <h1><span class="brand-accent">AJMANI</span> B2B</h1>
        <p>Authorized Dealer Access</p>
        
        <input type="text" id="username" placeholder="Dealer Username">
        <input type="password" id="password" placeholder="Passcode">
        
        <button onclick="attemptLogin()">Secure Login</button>
        <div id="error-msg" class="error">❌ Invalid Username or Password</div>
    </div>

    <script>
        // Allow pressing "Enter" on keyboard to trigger login
        document.getElementById("password").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                attemptLogin();
            }
        });

        async function attemptLogin() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const errorBox = document.getElementById('error-msg');
            
            if(!user || !pass) {
                errorBox.innerText = "⚠️ Please enter both username and password.";
                errorBox.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, password: pass })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Save the dealer's ID and Name to the browser securely
                    localStorage.setItem('dealer_access', 'granted');
                    localStorage.setItem('dealer_id', result.user.id);
                    localStorage.setItem('dealer_name', result.user.full_name);
                    
                    // Break through the lock and go to the trading floor
                    window.location.href = '/trade.html';
                } else {
                    errorBox.innerText = "❌ Invalid Username or Password";
                    errorBox.style.display = 'block';
                }
            } catch(err) { 
                errorBox.innerText = "❌ Server Connection Error";
                errorBox.style.display = 'block';
            }
        }
    </script>
</body>
</html>